---
layout: post
title: "Jakarta EE 9.1 support and configurable response headers in Open Liberty 21.0.0.12"
# Do NOT change the categories section
categories: blog
author_picture: https://avatars3.githubusercontent.com/ryan-storey
author_github: https://github.com/ryan-storey
seo-title: Jakarta EE 9.1 support and configurable response headers in Open Liberty 21.0.0.12 - OpenLiberty.io
seo-description: Open Liberty 21.0.0.12 offers exciting new enhancements such as Jakarta EE 9.1 support, and configurable response headers, which offer more granular control over response headers. This release also provides several significant bug fixes.
blog_description: Open Liberty 21.0.0.12 offers exciting new enhancements such as Jakarta EE 9.1 support, and configurable response headers, which offer more granular control over response headers. This release also provides several significant bug fixes.
open-graph-image: https://openliberty.io/img/twitter_card.jpg
---
= Jakarta EE 9.1 support and configurable response headers in Open Liberty 21.0.0.12
Ryan Storey <https://github.com/ryan-storey>
:imagesdir: /
:url-prefixx
:url-about: /
//Blank line here is necessary before starting the body of the post.

Open Liberty 21.0.0.12 offers exciting new enhancements such as Jakarta EE 9.1 support, and configurable response headers, which offer more granular control over response headers. This release also provides several significant bug fixes.

In link:{url-about}[Open Liberty] 21.0.0.12:

* <<jee_9.1, Jakarta EE 9.1 support>>
* <<response_headers, Configurable Response Headers>>
** <<SUB_TAG_1, SUB_FEATURE_1_HEADING>>
** <<SUB_TAG_2, SUB_FEATURE_2_HEADING>>
* <<TAG_3, FEATURE_3_HEADING>>

View the list of fixed bugs in link:https://github.com/OpenLiberty/open-liberty/issues?q=label%3Arelease%3A21.0.0.12+label%3A%22release+bug%22[21.0.0.12].


[#run]
== Run your apps using 21.0.0.12

If you're using link:{url-prefix}/guides/maven-intro.html[Maven], here are the coordinates:

[source,xml]
----
<dependency>
    <groupId>io.openliberty</groupId>
    <artifactId>openliberty-runtime</artifactId>
    <version>21.0.0.12</version>
    <type>zip</type>
</dependency>
----

Or for link:{url-prefix}/guides/gradle-intro.html[Gradle]:

[source,gradle]
----
dependencies {
    libertyRuntime group: 'io.openliberty', name: 'openliberty-runtime', version: '[21.0.0.12,)'
}
----

Or if you're using Docker:

[source]
----
FROM open-liberty
----

Or take a look at our link:{url-prefix}/downloads/[Downloads page].

[link=https://stackoverflow.com/tags/open-liberty]
image::img/blog/blog_btn_stack.svg[Ask a question on Stack Overflow, align="center"]

[#jee_9.1]
== Jakarta EE 9.1 support

Jakarta EE 9 support is available with the 21.0.0.12 release of Open Liberty.  This support allows you to run Jakarta EE 9 applications using Java 8, 11, or 17 with other Open Liberty value-add features that are updated to support Jakarta EE 9.  

With the RESTful Web Services 3.0 (formerly called JAXRS) support in Open Liberty, there is a significant performance improvement for applications who use the RESTful Web Services function.  This performance improvement was achieved by moving our RESTful Web Services implementation from Apache CXF to using RestEasy.  With this new version, CDI is enabled by default, and JSON Binding is not enabled by default with the feature being specified in your `server.xml`.   

Any Liberty features with API and/or SPI functions that use Jakarta EE APIs as part of their method signatures have been updated to have their package versions be reset to 10.0 when using those API / SPIs with Jakarta EE 9.  Any bundles used for user features that depend on those packages will need to change the import package version range when updating the user feature to use Jakarta EE 9.

With the introduction of Jakarta EE 9.1, the Jakarta Enterprise Beans 4.0 specification includes a few minor changes over the prior version of the specification, Enterprise JavaBeans (EJB) 3.2, as follows.
  
*  Note the new names of the features; all of the same features exist, but the feature name prefix has changed from `ejb` to `enterpriseBeans`.  For example, `enterpriseBeansLite-4.0` is the new version of `ejbLite-3.2`.
* The API package has changed from `javax.ejb` to `jakarta.ejb`
* The `@Schedule` annotation is now repeatable
* The following API methods have been removed:
** `javax.ejb.EJBContext.getCallerIdentity()` -> use `getCallerPrincipal()`
** `javax.ejb.EJBContext.getEnvironment()` -> use `JNDI` lookup in `java:comp/env`
** `javax.ejb.EJBContext.isCallerInRole(java.security.Identity)` -> use `isCallerInRole(String)`
** `javax.ejb.SessionContext.getMessageContext()` (removed with `JAX-RPC`)
   
All other capabilities of Enterprise Beans remain the same as the prior specification version (3.2).

Enable the Jakarta EE 9 features in your app’s `server.xml`. You can enable the individual features you want or you can just add the Jakarta EE 9 convenience feature to enable all of the Jakarta EE 9 features at once:

[source,xml]
----
  <featureManager>
    <feature>jakartaee-9.1</feature>
  </featureManager>
----

Or you can add the Web Profile convenience feature to enable all of the Jakarta EE 9 Web Profile features at once:

[source,xml]
----
  <featureManager>
    <feature>webProfile-9.1</feature>
  </featureManager>
----

Provide a link to the new documentation about Jakarta EE 9 feature names, and a copy of the table in the blog post.  Also if available link to the RESTful WS updates page talking about changes in RESTful Web Services 3.0.

See also https://github.com/OpenLiberty/open-liberty/issues/19395 for content about Jakarta Enterprise Beans function.

[#response_headers]
== Configurable Response Headers

You can now configure Open Liberty to modify response headers.  The available configuration options allow for headers to be appended, for existing headers to be overwritten, for missing headers to be added, and for undesired headers to be removed from all responses being serviced by an HTTP endpoint. This configuration offers more granular control over response headers, which offers a solution to modifying headers without the need to change existing applications, filters, or otherwise. 

To use configurable response headers, begin by defining a new element called `<headers>` in the `server.xml`.  You can configure this for individual HTTP endpoints or for all endpoints at once. 

Configuring for individual HTTP endpoints:

[source, xml]
----
<httpEndpoint id="defaultHttpEndpoint"
                  httpPort="9080"
                  httpsPort="9443" >
	 
       <headers>
            <add>foo:bar</add>
            <add>foo:bar2</add>
            <set>customHeader:customValue</set>
            <setIfMissing>X-Forwarded-Proto:https</setIfMissing>
            <remove>Via</remove>
       </headers>
   		
</httpEndpoint>
----

Configuring for all HTTP endpoints:

[source, xml]
----
 <httpEndpoint id="defaultHttpEndpoint"
                         httpPort="9080"
                         httpsPort="9443"
                         headersRef="myHeadersID">
     </httpEndpoint>
 
     <httpEndpoint id="otherHttpEndpoint"
                         httpPort="9081"
                         httpsPort="9444"
                         headersRef="myHeadersID">
    </httpEndpoint> 
     
     <headers id="myHeadersID">
            <add>foo:bar</add>
            <add>foo:bar2</add>
            <set>customHeader:customValue</set>
            <setIfMissing>X-Forwarded-Proto:https</setIfMissing>
            <remove>Via</remove>
     </headers>  
----

The `add` attribute allows multiple headers with the same name to be added to a response, similar to the HttpServletResponse's `addHeader` API. Similarly, the `set` attribute is analogous to the `setHeader` API, which sets a response header to the given name and value. This overwrites existing headers that share the same name. The `setIfMissing` attribute will only set the configured headers if they are not already present on the response. Lastly, the `remove` attribute will remove any response headers whose name matches a name defined by the configuration. 

Each header entry for the `add`, `set`, and `setIfMissing` attributes can be provided as a standalone header name. Optionally, a header value can be added by appending the colon `:` character after every header name. Note, however, that the `remove` attribute only expects header names and not a header name:value pair.

As seen in the example above, one way to configure the `<headers>` element is to declare each individual header within it own `add`, `set`, `setIfMissing`, or `remove` attribute. In addition to this configuration, headers can be provided as a comma delimited list. 

The following server.xml configuration declares individual headers within the desired configuration attributes: 

[source, xml]
----
<headers>
            <add>foo:bar</add>
            <add>foo:bar2</add>
            <set>customHeader:customValue</set>
            <setIfMissing>X-Forwarded-Proto:https</setIfMissing>
            <remove>Via</remove>
</headers>
----

This configuration can also be declared as comma delimited lists, such as: 

[source, xml]
----
<headers add="foo:bar, foo:bar2" set="customHeader:customValue" setIfMissing="X-Forwarded-Proto:https" remove="Via"/>
----

There are three warning messages relating to misconfigurations for this feature. Note that if a configuration value is considered to be misconfigured, it will not be utilized. Furthermore, if the misconfigured value had a non-empty header name, any further configurations with this same name will also be ignored.

The first warning message, `CWWKT0042W`, will be logged whenever a header name is left empty. While header values are completely optional, the configuration does expect a non-empty header name. 

The `add` configuration allows for multiple headers with the same name to be configured. However, it would be ambiguous to repeat a header name in any other configuration attribute. For instance, consider the `set` attribute option, which is meant to overwrite an existing header that shared the declared header name. If the `set` configuration contained two headers with the same name, it would be unclear which of the two values should be chosen. Similarly, if the same header name is present in two or more configurations, the same ambiguity is true. As such, and excluding repetitions in the `add` configuration, whenever a header name is found to be used more than once,  the warning message `CWWKT0043W` will be logged. 

The third warning message, `CWWKT0044W`, is logged if a header that has already been flagged as a duplicate by the `CWWKT0043W` warning message, continues to be utilized by further configurations. 

**Warning Message Descriptions:** 

`CWWKT0042W` : An empty header name was found when the 'set` configuration was parsed. This value is ignored.

`CWWKT0043W` : A duplicate header name was found in the [foo] header using the `set` configuration. All configurations for the [foo] header are ignored. Any header that is defined by the remove, add, set, or setIfMissing configurations must be unique across all configurations.

`CWWKT0044W` : The [foo] header, which is marked as a duplicate header name, was found in the `set` configuration. The [foo] header is ignored. Any header that is defined by the `set` configuration must contain unique header names.

**Summary**

Open Liberty now provides a way to control response headers for a given HTTP endpoint. These can be appended, configured to overwrite, to only be added if not already present, or completely removed from all responses. Try it out for yourself! 

[#bugs]
== Notable bugs fixed in this release


We’ve spent some time fixing bugs. The following sections describe just some of the issues resolved in this release. If you’re interested, here’s the  link:https://github.com/OpenLiberty/open-liberty/issues?q=label%3Arelease%3A21.0.0.12+label%3A%22release+bug%22[full list of bugs fixed in 21.0.0.12].

== Get Open Liberty 21.0.0.12 now

Available through <<run,Maven, Gradle, Docker, and as a downloadable archive>>.
