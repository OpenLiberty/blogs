---
layout: post
title: "TITLE"
categories: blog
author_picture: https://avatars3.githubusercontent.com/
author_github: https://github.com/GITHUB_USERNAME
seo-title: TITLE - makes sure it ends with - OpenLiberty.io
seo-description: DESCRIPTION
blog_description: DESCRIPTION
---
= TITLE
AUTHOR_NAME <https://github.com/GITHUB_USERNAME>
:imagesdir: /
:url-prefix:
:url-about: /about/

// // // // // // // //
// Above:
// Do not insert any blank lines between any of the lines above.
// Do not remove or edit the variables on the lines beneath the author name.
//
// Replace TITLE with the blog post title eg: MicroProfile 3.3 is now available on Open Liberty 20.0.0.4
// Replace GITHUB_USERNAME with your GitHub username eg: lauracowen
// Replace DESCRIPTION with a short summary (~60 words) of the release (a more succinct version of the first paragraph of the post).
// Replace AUTHOR_NAME with your name as you'd like it to be displayed, eg: Laura Cowen
//
// Example post: 2020-04-09-microprofile-3-3-open-liberty-20004.adoc
// // // // // // // //
// tag::intro[]
With Open Liberty you can now access HTTP log fields in JSON logs which allows users to include fields from the accessLogging logFormat attribute in their JSON logs. Also allows for JSON to be written directly to system.out with out wrapping in the liberty_message event.
// // // // // // // //
// Above:
// Leave any instances of `tag::xxxx[]` or `end:xxxx[]` as they are.
//
// Replace RELEASE_SUMMARY with a short paragraph that summarises the release. Start with the lead feature but also summarise what else is new in the release. You will agree which will be the lead feature with the reviewers so you can just leave a placeholder here until after the initial review.
// // // // // // // //
In link:{url-about}[Open Liberty] 20.0.0.8:
* <<accessJSON, HTTP access log fields in JSON logs>>
* <<JSONtoSystemOut, Allow JSON written to System.out to pass without wrapping>>
// // // // // // // //
// Above:
// Replace RELEASE_VERSION with the version number of Open Liberty, eg: 20.0.0.4
// Replace the TAG_X with a short label for the feature in lower-case, eg: mp3
// Replace the FEATURE_1_HEADING with heading the feature section, eg: MicroProfile 3.3
// Where the updates are grouped as sub-headings under a single heading 
//   (eg all the features in a MicroProfile release), provide sub-entries in the list; 
//   eg replace SUB_TAG_1 with mpr, and SUB_FEATURE_1_HEADING with 
//   Easily determine HTTP headers on outgoing requests (MicroProfile Rest Client 1.4)
// // // // // // // //
View the list of fixed bugs in link:https://github.com/OpenLiberty/open-liberty/issues?q=label%3Arelease%3A20009+label%3A%22release+bug%22+[20.0.0.8].
// end::intro[]
// // // // // // // //
// Above:
// Replace RELEASE_VERSION_PATH with the path in the following format: 
//   issues?q=label%3Arelease%3A20003+label%3A%22release+bug%22+ 
//   where `20003` is replaced with release version without the periods, eg: 20004
// Replace the RELEASE_VERSION with the Open Liberty release number e.g. 20.0.0.4
// // // // // // // //
// tag::run[]
[#run]
// // // // // // // //
// LINKS
//
// OpenLiberty.io site links:
// link:{url-prefix}/guides/maven-intro.html[Maven]
// 
// Off-site links:
//link:https://openapi-generator.tech/docs/installation#jar[Download Instructions]
//
// IMAGES
//
// Place images in ./img/blog/
// Use the syntax:
// image::/img/blog/log4j-rhocp-diagrams/current-problem.png[Logging problem diagram,width=70%,align="center"]
// // // // // // // //
== Run your apps using 20.0.0.8
If you're using link:{url-prefix}/guides/maven-intro.html[Maven], here are the coordinates:
[source,xml]
----
<dependency>
    <groupId>io.openliberty</groupId>
    <artifactId>openliberty-runtime</artifactId>
    <version>20.0.0.8</version>
    <type>zip</type>
</dependency>
----
Or for link:{url-prefix}/guides/gradle-intro.html[Gradle]:
[source,gradle]
----
dependencies {
    libertyRuntime group: 'io.openliberty', name: 'openliberty-runtime', version: '[20.0.0.8,)'
}
----
Or if you're using Docker:
[source]
----
FROM open-liberty
----
//end::run[]
// // // // // // // //
// Above:
// Replace the RELEASE_VERSION with the Open Liberty release number e.g. 20.0.0.4
// // // // // // // //
Or take a look at our link:{url-prefix}/downloads/[Downloads page].
[link=https://stackoverflow.com/tags/open-liberty]
image::img/blog/blog_btn_stack.svg[Ask a question on Stack Overflow, align="center"]
//tag::features[]
[#accessJSON]
=== HTTP access log fields in JSON logs
// Add the introduction to the feature and description here
In Open Liberty, users have the option to format their server logs in either basic or JSON format. When logs are in JSON format, users have to specify the sources (message, trace, accessLog, ffdc, audit) they want to send to messages.log or console.log/standard-out. This feature adds an option for users to include fields from the accessLogging logFormat attribute in their JSON logs. Previously, only selected fields would be printed in JSON logs.Users are now able to include other NCSA access log fields in their JSON logs.

Also, users are now able to define which JSON access log fields they want from their accessLogging logFormat property, which can then be sent to a log analysis tool, such as the ELK (Elasticsearch, Logstash, Kibana) stack. With this new feature, users can receive more informative logs that suit their needs. For example, the user is able to specify that they want the user ID and request time fields in their JSON access logs -- then, they can filter by user ID in Kibana and track performance on a user-by-user basis.
When logs are in JSON format, you can use the new jsonAccessLogFields logging attribute to specify whether you want your access logs to have the default set of fields or a custom set of fields based on the HTTP 
accessLogging logFormat attribute. In order to receive access logs, the property accessLogging or httpAccessLogging must be set. For example, in your server.xml, set the following attributes:

[source, xml]
----
<httpEndpoint id="defaultHttpEndpoint" httpPort="9080" httpsPort="9443" host="*">
        <accessLogging logFormat='%R{W} %u %{my_cookie}C %s'/>
    </httpEndpoint>
----

Now, in the messages.log file, your access logs will contain the four fields specified in the 
accessLogging logFormat attribute (elapsed time, user ID, cookie, and response code).

[source, xml]
----
    {
    "type": "liberty_accesslog",
    "host": "192.168.1.15",
    "ibm_userDir": "/Users/jennifer.zhen.chengibm.com/libertyGit/open-liberty/dev/build.image/wlp/usr/",
    "ibm_serverName": "defaultServer",
    "ibm_cookie_my_cookie": "example_cookie",
    "ibm_responseCode": 200,
    "ibm_datetime": "2020-06-18T09:30:47.693-0400",
    "ibm_sequence": "1592487047653_0000000000001"
    }
----


This new functionality is also available for the logstashCollector-1.0 feature by adding the following to your server.xml:

[source, xml]
----
    <featureManager>
        <feature>logstashCollector-1.0</feature>
    </featureManager>

    <logstashCollector 
        jsonAccessLogFields="logFormat">
    </logstashCollector>

    <logging messageFormat="json" messageSource="message,accessLog" jsonAccessLogFields="logFormat"/>
----


For more information:

* https://openliberty.io/docs/ref/config/#logging.html[Open Liberty Logging]

* https://www.ibm.com/support/knowledgecenter/en/SSEQTP_liberty/com.ibm.websphere.wlp.doc/ae/rwlp_logging.html[IBM Logging and Trace]


[#JSONtoSystemOut]
=== Allow JSON written to System.out to pass without wrapping

In Open Liberty, users have the option to format their server logs in basic or JSON format. When logs are in JSON format, users have to specify the sources (message, trace, accessLog, ffdc, audit) they want to send to messages.log or console.log/standard-out. This feature adds a new option for users to write pre-formatted JSON application logs directly to System.out/System.err. Previously, when Open Liberty was running with JSON logging enabled, Open Liberty embeds anything written to System.out/System.err into the message field of a liberty_message event. Now, users can write JSON directly to System.out/err without wrapping in the liberty_message event.

Users can now write their JSON application logs directly to System.out/System.err, which can then be sent to a log analysis tool, such as the ELK (Elasticsearch, Logstash, Kibana) stack. Previously, when JSON logging was enabled, pre-formatted JSON application logs would look like this:

[source, xml]
----
{
     "type":"liberty_message",
     "host":"192.168.0.119",
     "ibm_userDir":"\/Users\/yushan.lin@ibm.com\/Documents\/archived-guide-log4j\/finish\/target\/liberty\/wlp\/usr\/",
     "ibm_serverName":"log4j.sampleServer",
     "message":"{\n   \"timeMillis\" : 1587666082123,\n  
             \"thread\" : \"Default Executor-thread-8\",\n  
             \"level\" : \"WARN\",\n  
              \"loggerName\" : \"application.servlet.LibertyServlet\",\n  
              \"message\" : \"hello liberty servlet warning message!\",\n  
              \"endOfBatch\" : false,\n  
              \"loggerFqcn\" : \"org.apache.logging.log4j.spi.AbstractLogger\",\n  
              \"threadId\" : 53,\n  
              \"threadPriority\" : 5\n}\r",
     "ibm_threadId":"00000035",
     "ibm_datetime":"2020-04-23T14:21:22.124-0400",
     "module":"SystemOut",
     "loglevel":"SystemOut",
     "ibm_methodName":"",
     "ibm_className":"", 
     "ibm_sequence":"1587666082124_000000000001B",
     "ext_thread":"Default Executor-thread-8”
}
----
Now users can output their logs so that pre-formatted JSON logs are not wrapped in liberty_message events. Visualization tools such as Kibana can be used to analyze certain fields in their JSON logs. Users can analyze both their custom-formatted JSON application logs and Liberty JSON logs in the same visualization.

Users can enable this functionality at any time by setting appsWriteJson="true" in the logging element of the server.xml , or can have it set from the moment the server starts by setting in bootstrap.properties:
com.ibm.ws.logging.apps.write.json=true

For more information:

* https://openliberty.io/docs/ref/config/#logging.html[Open Liberty Logging]


== Get Open Liberty 20.0.0.8 now
Available through <<run,Maven, Gradle, Docker, and as a downloadable archive>>.
